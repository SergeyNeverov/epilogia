'use strict';

document.addEventListener('DOMContentLoaded', function () {
  var mapContainer = document.getElementById('map');
  var modalsSelector = document.querySelectorAll('.modal');
  var modalTriggers = document.querySelectorAll('.modal-trigger');
  var calculatorSelects = document.querySelectorAll('.calculator-select');
  var sliders = document.querySelectorAll('.slider');
  var timers = document.querySelectorAll('.timer');
  var accordeonButtons = document.querySelectorAll('.accordeon__title');
  var maskedPhones = document.querySelectorAll('input[data-masked="phone"]');
  var modals = document.querySelectorAll('.modal');

  svg4everybody();
  modalsSelector.forEach(function (element) {
    $(element).iziModal();
  });

  modalTriggers.forEach(function (trigger) {
    trigger.addEventListener('click', function () {
      var id = this.dataset.open;
      var modal = document.querySelectorAll('.modal[data-modal=' + id + ']');
      $(modal).iziModal('open');
    });
  });

  var i = 0;
  calculatorSelects.forEach(function (select) {
    select.addEventListener('click', function () {
      var sum = 0;
      var sumWithoutSale = 0;
      var count = document.querySelectorAll('.calculator-select.active');
      var textCount = document.querySelector('p[data-calculator-count=""]');
      var totalPrice = document.querySelector('strong[data-calculator-total=""]');
      var totalPriceWithoutSale = document.querySelector('span[data-calculator-sale=""]');
      var price = +select.dataset.price;
      var priceWithoutSale = +select.dataset.sale;

      if (select.classList.contains('active')) {
        i--;
        select.classList.remove('active');
        sum -= price;
        sumWithoutSale -= priceWithoutSale;
        textCount.innerHTML = i;
        count.forEach(function (current) {
          var price = +current.dataset.price;
          var priceWithoutSale = +current.dataset.sale;
          sum += price;
          sumWithoutSale += priceWithoutSale;
          return sum, sumWithoutSale;
        });
      } else {
        i++;
        select.classList.add('active');
        sum += price;
        sumWithoutSale += priceWithoutSale;
        textCount.innerHTML = i;
        count.forEach(function (current) {
          var price = +current.dataset.price;
          var priceWithoutSale = +current.dataset.sale;
          sum += price;
          sumWithoutSale += priceWithoutSale;
          return sum, sumWithoutSale;
        });
      }
      totalPrice.innerHTML = sum + ' р.';
      totalPriceWithoutSale.innerHTML = sumWithoutSale + 'р.';
    });
  });

  sliders.forEach(function (slider) {
    var sliderInit = slider.querySelector('.slider__list');
    var count = sliderInit.getAttribute('data-count');
    var nextArrow = slider.querySelector('.arrow-next');
    var prevArrow = slider.querySelector('.arrow-prev');
    $(sliderInit).slick({
      slidesToShow: +count,
      dots: false,
      prevArrow: $(prevArrow),
      nextArrow: $(nextArrow)
    });
  });

  timers.forEach(function (timer) {
    var getTimeRemaining = function getTimeRemaining(endtime) {
      var t = Date.parse(endtime) - Date.parse(new Date());
      var seconds = Math.floor(t / 1000 % 60);
      var minutes = Math.floor(t / 1000 / 60 % 60);
      var hours = Math.floor(t / (1000 * 60 * 60) % 24);
      var days = Math.floor(t / (1000 * 60 * 60 * 24));
      return {
        'total': t,
        'days': days,
        'hours': hours,
        'minutes': minutes,
        'seconds': seconds
      };
    };

    var initializeClock = function initializeClock(endtime) {
      var clock = timer;
      var daysSpan = clock.querySelector('.timer__day');
      var hoursSpan = clock.querySelector('.timer__hours');
      var minutesSpan = clock.querySelector('.timer__minutes');
      var secondsSpan = clock.querySelector('.timer__seconds');

      var updateClock = function updateClock() {
        var t = getTimeRemaining(endtime);

        daysSpan.innerHTML = t.days;
        hoursSpan.innerHTML = ('0' + t.hours).slice(-2);
        minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
        secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

        if (t.total <= 0) {
          clearInterval(timeinterval);
        }
      };
      updateClock();
      var timeinterval = setInterval(updateClock, 1000);
    };
    var deadline = new Date(Date.parse(new Date()) + 15 * 24 * 60 * 60 * 1000);
    initializeClock(deadline);
  });

  accordeonButtons.forEach(function (accordeon) {
    accordeon.addEventListener('click', function () {
      accordeonButtons.forEach(function (accordeon) {
        accordeon.classList.remove('open');
        accordeon.closest('.accordeon').classList.remove('open');
      });
      accordeon.classList.add('open');
      accordeon.closest('.accordeon').classList.add('open');
      document.querySelector('.faq').scrollIntoView({ behavior: 'smooth' });
    });
  });

  var customOptions = {
    onKeyPress: function onKeyPress(val, e, field, options) {
      if (val.replace(/\D/g, "").length === 2) {
        val = val.replace("8", "");
        field.val(val);
      }
      field.mask("+7 (999) 999-99-99", options);
    },
    placeholder: "+7 (___) ___-__-__"
  };

  maskedPhones.forEach(function (input) {
    $(input).mask("+7 (000) 000-00-00", customOptions);
  });

  modals.forEach(function (modal) {
    var input = modal.querySelector('input[data-masked="phone"]');
    $(input).mask("+7 (000) 000-00-00", customOptions);
  });

  if (mapContainer) {
    var init = function init() {
      var myMap = new ymaps.Map("map", {
        center: [60.028979, 30.331195],
        zoom: 16,
        controls: ["zoomControl"]
      });

      var myPlacemark = new ymaps.Placemark([60.028979, 30.331195], {
        balloonContent: "г. Санкт-Петербург, ул. Есенина 1к1, ст.м. Озерки"
      }, {
        iconImageHref: "/img/marker.svg",
        iconLayout: "default#image",
        iconImageSize: [42, 56],
        iconImageOffset: [-21, -56]
      });
      myMap.geoObjects.add(myPlacemark);

      mapContainer.querySelectorAll('.ymaps-2-1-77-ground-pane').forEach(function (element) {
        element.style.filter = 'grayscale(1)';
      });
    };
    ymaps.ready(init);
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwibWFwQ29udGFpbmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJtb2RhbHNTZWxlY3RvciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtb2RhbFRyaWdnZXJzIiwiY2FsY3VsYXRvclNlbGVjdHMiLCJzbGlkZXJzIiwidGltZXJzIiwiYWNjb3JkZW9uQnV0dG9ucyIsIm1hc2tlZFBob25lcyIsIm1vZGFscyIsInN2ZzRldmVyeWJvZHkiLCJmb3JFYWNoIiwiZWxlbWVudCIsIiQiLCJpemlNb2RhbCIsInRyaWdnZXIiLCJpZCIsImRhdGFzZXQiLCJvcGVuIiwibW9kYWwiLCJpIiwic2VsZWN0Iiwic3VtIiwic3VtV2l0aG91dFNhbGUiLCJjb3VudCIsInRleHRDb3VudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0b3RhbFByaWNlIiwidG90YWxQcmljZVdpdGhvdXRTYWxlIiwicHJpY2UiLCJwcmljZVdpdGhvdXRTYWxlIiwic2FsZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiaW5uZXJIVE1MIiwiY3VycmVudCIsImFkZCIsInNsaWRlckluaXQiLCJzbGlkZXIiLCJnZXRBdHRyaWJ1dGUiLCJuZXh0QXJyb3ciLCJwcmV2QXJyb3ciLCJzbGljayIsInNsaWRlc1RvU2hvdyIsImRvdHMiLCJnZXRUaW1lUmVtYWluaW5nIiwiZW5kdGltZSIsInQiLCJEYXRlIiwicGFyc2UiLCJzZWNvbmRzIiwiTWF0aCIsImZsb29yIiwibWludXRlcyIsImhvdXJzIiwiZGF5cyIsImluaXRpYWxpemVDbG9jayIsImNsb2NrIiwidGltZXIiLCJkYXlzU3BhbiIsImhvdXJzU3BhbiIsIm1pbnV0ZXNTcGFuIiwic2Vjb25kc1NwYW4iLCJ1cGRhdGVDbG9jayIsInNsaWNlIiwidG90YWwiLCJjbGVhckludGVydmFsIiwidGltZWludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJkZWFkbGluZSIsImFjY29yZGVvbiIsImNsb3Nlc3QiLCJzY3JvbGxJbnRvVmlldyIsImJlaGF2aW9yIiwiY3VzdG9tT3B0aW9ucyIsIm9uS2V5UHJlc3MiLCJ2YWwiLCJlIiwiZmllbGQiLCJvcHRpb25zIiwicmVwbGFjZSIsImxlbmd0aCIsIm1hc2siLCJwbGFjZWhvbGRlciIsImlucHV0IiwiaW5pdCIsIm15TWFwIiwieW1hcHMiLCJNYXAiLCJjZW50ZXIiLCJ6b29tIiwiY29udHJvbHMiLCJteVBsYWNlbWFyayIsIlBsYWNlbWFyayIsImJhbGxvb25Db250ZW50IiwiaWNvbkltYWdlSHJlZiIsImljb25MYXlvdXQiLCJpY29uSW1hZ2VTaXplIiwiaWNvbkltYWdlT2Zmc2V0IiwiZ2VvT2JqZWN0cyIsInN0eWxlIiwiZmlsdGVyIiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQ0FBLFNBQVNDLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxZQUFJO0FBQ2hELE1BQU1DLGVBQWVGLFNBQVNHLGNBQVQsQ0FBd0IsS0FBeEIsQ0FBckI7QUFDQSxNQUFNQyxpQkFBa0JKLFNBQVNLLGdCQUFULENBQTBCLFFBQTFCLENBQXhCO0FBQ0EsTUFBTUMsZ0JBQWdCTixTQUFTSyxnQkFBVCxDQUEwQixnQkFBMUIsQ0FBdEI7QUFDQSxNQUFNRSxvQkFBb0JQLFNBQVNLLGdCQUFULENBQTBCLG9CQUExQixDQUExQjtBQUNBLE1BQU1HLFVBQVVSLFNBQVNLLGdCQUFULENBQTBCLFNBQTFCLENBQWhCO0FBQ0EsTUFBTUksU0FBU1QsU0FBU0ssZ0JBQVQsQ0FBMEIsUUFBMUIsQ0FBZjtBQUNBLE1BQU1LLG1CQUFtQlYsU0FBU0ssZ0JBQVQsQ0FBMEIsbUJBQTFCLENBQXpCO0FBQ0EsTUFBTU0sZUFBZVgsU0FBU0ssZ0JBQVQsQ0FBMEIsNEJBQTFCLENBQXJCO0FBQ0EsTUFBTU8sU0FBU1osU0FBU0ssZ0JBQVQsQ0FBMEIsUUFBMUIsQ0FBZjs7QUFFQVE7QUFDQVQsaUJBQWVVLE9BQWYsQ0FBdUIsVUFBQ0MsT0FBRCxFQUFZO0FBQ2pDQyxNQUFFRCxPQUFGLEVBQVdFLFFBQVg7QUFDRCxHQUZEOztBQUlBWCxnQkFBY1EsT0FBZCxDQUFzQixVQUFDSSxPQUFELEVBQVc7QUFDL0JBLFlBQVFqQixnQkFBUixDQUF5QixPQUF6QixFQUFrQyxZQUFXO0FBQzNDLFVBQU1rQixLQUFLLEtBQUtDLE9BQUwsQ0FBYUMsSUFBeEI7QUFDQSxVQUFNQyxRQUFRdEIsU0FBU0ssZ0JBQVQsd0JBQStDYyxFQUEvQyxPQUFkO0FBQ0FILFFBQUVNLEtBQUYsRUFBU0wsUUFBVCxDQUFrQixNQUFsQjtBQUNELEtBSkQ7QUFLRCxHQU5EOztBQVNBLE1BQUlNLElBQUksQ0FBUjtBQUNBaEIsb0JBQWtCTyxPQUFsQixDQUEwQixVQUFDVSxNQUFELEVBQVU7QUFDbENBLFdBQU92QixnQkFBUCxDQUF3QixPQUF4QixFQUFpQyxZQUFJO0FBQ25DLFVBQUl3QixNQUFNLENBQVY7QUFDQSxVQUFJQyxpQkFBaUIsQ0FBckI7QUFDQSxVQUFJQyxRQUFRM0IsU0FBU0ssZ0JBQVQsQ0FBMEIsMkJBQTFCLENBQVo7QUFDQSxVQUFNdUIsWUFBWTVCLFNBQVM2QixhQUFULENBQXVCLDZCQUF2QixDQUFsQjtBQUNBLFVBQU1DLGFBQWE5QixTQUFTNkIsYUFBVCxDQUF1QixrQ0FBdkIsQ0FBbkI7QUFDQSxVQUFNRSx3QkFBd0IvQixTQUFTNkIsYUFBVCxDQUF1QiwrQkFBdkIsQ0FBOUI7QUFDQSxVQUFNRyxRQUFRLENBQUNSLE9BQU9KLE9BQVAsQ0FBZVksS0FBOUI7QUFDQSxVQUFNQyxtQkFBbUIsQ0FBQ1QsT0FBT0osT0FBUCxDQUFlYyxJQUF6Qzs7QUFFQSxVQUFHVixPQUFPVyxTQUFQLENBQWlCQyxRQUFqQixDQUEwQixRQUExQixDQUFILEVBQXdDO0FBQ3RDYjtBQUNBQyxlQUFPVyxTQUFQLENBQWlCRSxNQUFqQixDQUF3QixRQUF4QjtBQUNBWixlQUFPTyxLQUFQO0FBQ0FOLDBCQUFrQk8sZ0JBQWxCO0FBQ0FMLGtCQUFVVSxTQUFWLEdBQXNCZixDQUF0QjtBQUNBSSxjQUFNYixPQUFOLENBQWMsbUJBQVc7QUFDdkIsY0FBTWtCLFFBQVEsQ0FBQ08sUUFBUW5CLE9BQVIsQ0FBZ0JZLEtBQS9CO0FBQ0EsY0FBTUMsbUJBQW1CLENBQUNNLFFBQVFuQixPQUFSLENBQWdCYyxJQUExQztBQUNBVCxpQkFBT08sS0FBUDtBQUNBTiw0QkFBa0JPLGdCQUFsQjtBQUNBLGlCQUFPUixLQUFLQyxjQUFaO0FBQ0QsU0FORDtBQU9ELE9BYkQsTUFhTztBQUNMSDtBQUNBQyxlQUFPVyxTQUFQLENBQWlCSyxHQUFqQixDQUFxQixRQUFyQjtBQUNBZixlQUFPTyxLQUFQO0FBQ0FOLDBCQUFrQk8sZ0JBQWxCO0FBQ0FMLGtCQUFVVSxTQUFWLEdBQXNCZixDQUF0QjtBQUNBSSxjQUFNYixPQUFOLENBQWMsbUJBQVc7QUFDdkIsY0FBTWtCLFFBQVEsQ0FBQ08sUUFBUW5CLE9BQVIsQ0FBZ0JZLEtBQS9CO0FBQ0EsY0FBTUMsbUJBQW1CLENBQUNNLFFBQVFuQixPQUFSLENBQWdCYyxJQUExQztBQUNBVCxpQkFBT08sS0FBUDtBQUNBTiw0QkFBa0JPLGdCQUFsQjtBQUNBLGlCQUFPUixLQUFLQyxjQUFaO0FBQ0QsU0FORDtBQU9EO0FBQ0RJLGlCQUFXUSxTQUFYLEdBQXVCYixNQUFNLEtBQTdCO0FBQ0FNLDRCQUFzQk8sU0FBdEIsR0FBa0NaLGlCQUFpQixJQUFuRDtBQUNELEtBdkNEO0FBeUNELEdBMUNEOztBQTRDQWxCLFVBQVFNLE9BQVIsQ0FBZ0Isa0JBQVU7QUFDeEIsUUFBTTJCLGFBQWFDLE9BQU9iLGFBQVAsQ0FBcUIsZUFBckIsQ0FBbkI7QUFDQSxRQUFNRixRQUFRYyxXQUFXRSxZQUFYLENBQXdCLFlBQXhCLENBQWQ7QUFDQSxRQUFNQyxZQUFZRixPQUFPYixhQUFQLENBQXFCLGFBQXJCLENBQWxCO0FBQ0EsUUFBTWdCLFlBQVlILE9BQU9iLGFBQVAsQ0FBcUIsYUFBckIsQ0FBbEI7QUFDQWIsTUFBRXlCLFVBQUYsRUFBY0ssS0FBZCxDQUFvQjtBQUNsQkMsb0JBQWEsQ0FBQ3BCLEtBREk7QUFFbEJxQixZQUFNLEtBRlk7QUFHbEJILGlCQUFXN0IsRUFBRTZCLFNBQUYsQ0FITztBQUlsQkQsaUJBQVc1QixFQUFFNEIsU0FBRjtBQUpPLEtBQXBCO0FBTUQsR0FYRDs7QUFjQW5DLFNBQU9LLE9BQVAsQ0FBZSxpQkFBUztBQUN4QixRQUFNbUMsbUJBQW1CLFNBQW5CQSxnQkFBbUIsQ0FBQ0MsT0FBRCxFQUFZO0FBQ25DLFVBQU1DLElBQUlDLEtBQUtDLEtBQUwsQ0FBV0gsT0FBWCxJQUFzQkUsS0FBS0MsS0FBTCxDQUFXLElBQUlELElBQUosRUFBWCxDQUFoQztBQUNBLFVBQU1FLFVBQVVDLEtBQUtDLEtBQUwsQ0FBWUwsSUFBSSxJQUFMLEdBQWEsRUFBeEIsQ0FBaEI7QUFDQSxVQUFNTSxVQUFVRixLQUFLQyxLQUFMLENBQVlMLElBQUksSUFBSixHQUFXLEVBQVosR0FBa0IsRUFBN0IsQ0FBaEI7QUFDQSxVQUFNTyxRQUFRSCxLQUFLQyxLQUFMLENBQVlMLEtBQUssT0FBTyxFQUFQLEdBQVksRUFBakIsQ0FBRCxHQUF5QixFQUFwQyxDQUFkO0FBQ0EsVUFBTVEsT0FBT0osS0FBS0MsS0FBTCxDQUFXTCxLQUFLLE9BQU8sRUFBUCxHQUFZLEVBQVosR0FBaUIsRUFBdEIsQ0FBWCxDQUFiO0FBQ0EsYUFBTztBQUNMLGlCQUFTQSxDQURKO0FBRUwsZ0JBQVFRLElBRkg7QUFHTCxpQkFBU0QsS0FISjtBQUlMLG1CQUFXRCxPQUpOO0FBS0wsbUJBQVdIO0FBTE4sT0FBUDtBQU9ELEtBYkQ7O0FBZUEsUUFBTU0sa0JBQWtCLFNBQWxCQSxlQUFrQixDQUFDVixPQUFELEVBQWE7QUFDbkMsVUFBTVcsUUFBUUMsS0FBZDtBQUNBLFVBQU1DLFdBQVdGLE1BQU1oQyxhQUFOLENBQW9CLGFBQXBCLENBQWpCO0FBQ0EsVUFBTW1DLFlBQVlILE1BQU1oQyxhQUFOLENBQW9CLGVBQXBCLENBQWxCO0FBQ0EsVUFBTW9DLGNBQWNKLE1BQU1oQyxhQUFOLENBQW9CLGlCQUFwQixDQUFwQjtBQUNBLFVBQU1xQyxjQUFjTCxNQUFNaEMsYUFBTixDQUFvQixpQkFBcEIsQ0FBcEI7O0FBRUEsVUFBTXNDLGNBQWMsU0FBZEEsV0FBYyxHQUFNO0FBQ3hCLFlBQU1oQixJQUFJRixpQkFBaUJDLE9BQWpCLENBQVY7O0FBRUFhLGlCQUFTekIsU0FBVCxHQUFxQmEsRUFBRVEsSUFBdkI7QUFDQUssa0JBQVUxQixTQUFWLEdBQXNCLENBQUMsTUFBTWEsRUFBRU8sS0FBVCxFQUFnQlUsS0FBaEIsQ0FBc0IsQ0FBQyxDQUF2QixDQUF0QjtBQUNBSCxvQkFBWTNCLFNBQVosR0FBd0IsQ0FBQyxNQUFNYSxFQUFFTSxPQUFULEVBQWtCVyxLQUFsQixDQUF3QixDQUFDLENBQXpCLENBQXhCO0FBQ0FGLG9CQUFZNUIsU0FBWixHQUF3QixDQUFDLE1BQU1hLEVBQUVHLE9BQVQsRUFBa0JjLEtBQWxCLENBQXdCLENBQUMsQ0FBekIsQ0FBeEI7O0FBRUEsWUFBSWpCLEVBQUVrQixLQUFGLElBQVcsQ0FBZixFQUFrQjtBQUNoQkMsd0JBQWNDLFlBQWQ7QUFDRDtBQUNGLE9BWEQ7QUFZQUo7QUFDQSxVQUFNSSxlQUFlQyxZQUFZTCxXQUFaLEVBQXlCLElBQXpCLENBQXJCO0FBQ0QsS0FyQkQ7QUFzQkUsUUFBTU0sV0FBVyxJQUFJckIsSUFBSixDQUFTQSxLQUFLQyxLQUFMLENBQVcsSUFBSUQsSUFBSixFQUFYLElBQXlCLEtBQUssRUFBTCxHQUFVLEVBQVYsR0FBZSxFQUFmLEdBQW9CLElBQXRELENBQWpCO0FBQ0FRLG9CQUFnQmEsUUFBaEI7QUFDRCxHQXhDRDs7QUEwQ0EvRCxtQkFBaUJJLE9BQWpCLENBQXlCLHFCQUFhO0FBQ3BDNEQsY0FBVXpFLGdCQUFWLENBQTJCLE9BQTNCLEVBQW9DLFlBQUs7QUFDdkNTLHVCQUFpQkksT0FBakIsQ0FBeUIscUJBQWE7QUFDcEM0RCxrQkFBVXZDLFNBQVYsQ0FBb0JFLE1BQXBCLENBQTJCLE1BQTNCO0FBQ0FxQyxrQkFBVUMsT0FBVixDQUFrQixZQUFsQixFQUFnQ3hDLFNBQWhDLENBQTBDRSxNQUExQyxDQUFpRCxNQUFqRDtBQUNELE9BSEQ7QUFJQXFDLGdCQUFVdkMsU0FBVixDQUFvQkssR0FBcEIsQ0FBd0IsTUFBeEI7QUFDQWtDLGdCQUFVQyxPQUFWLENBQWtCLFlBQWxCLEVBQWdDeEMsU0FBaEMsQ0FBMENLLEdBQTFDLENBQThDLE1BQTlDO0FBQ0F4QyxlQUFTNkIsYUFBVCxDQUF1QixNQUF2QixFQUErQitDLGNBQS9CLENBQThDLEVBQUNDLFVBQVUsUUFBWCxFQUE5QztBQUNELEtBUkQ7QUFTRCxHQVZEOztBQWFBLE1BQU1DLGdCQUFnQjtBQUNwQkMsZ0JBQVksb0JBQVVDLEdBQVYsRUFBZUMsQ0FBZixFQUFrQkMsS0FBbEIsRUFBeUJDLE9BQXpCLEVBQWtDO0FBQzVDLFVBQUlILElBQUlJLE9BQUosQ0FBWSxLQUFaLEVBQW1CLEVBQW5CLEVBQXVCQyxNQUF2QixLQUFrQyxDQUF0QyxFQUF5QztBQUN2Q0wsY0FBTUEsSUFBSUksT0FBSixDQUFZLEdBQVosRUFBaUIsRUFBakIsQ0FBTjtBQUNBRixjQUFNRixHQUFOLENBQVVBLEdBQVY7QUFDRDtBQUNERSxZQUFNSSxJQUFOLENBQVcsb0JBQVgsRUFBaUNILE9BQWpDO0FBQ0QsS0FQbUI7QUFRcEJJLGlCQUFhO0FBUk8sR0FBdEI7O0FBV0E1RSxlQUFhRyxPQUFiLENBQXFCLGlCQUFTO0FBQzVCRSxNQUFFd0UsS0FBRixFQUFTRixJQUFULENBQWMsb0JBQWQsRUFBb0NSLGFBQXBDO0FBQ0QsR0FGRDs7QUFJQWxFLFNBQU9FLE9BQVAsQ0FBZSxpQkFBUztBQUN0QixRQUFNMEUsUUFBUWxFLE1BQU1PLGFBQU4sQ0FBb0IsNEJBQXBCLENBQWQ7QUFDQWIsTUFBRXdFLEtBQUYsRUFBU0YsSUFBVCxDQUFjLG9CQUFkLEVBQW9DUixhQUFwQztBQUNELEdBSEQ7O0FBS0EsTUFBRzVFLFlBQUgsRUFBaUI7QUFDWCxRQUFNdUYsT0FBTyxTQUFTQSxJQUFULEdBQWdCO0FBQzNCLFVBQU1DLFFBQVEsSUFBSUMsTUFBTUMsR0FBVixDQUFjLEtBQWQsRUFBcUI7QUFDakNDLGdCQUFRLENBQUMsU0FBRCxFQUFZLFNBQVosQ0FEeUI7QUFFakNDLGNBQU0sRUFGMkI7QUFHakNDLGtCQUFVLENBQUMsYUFBRDtBQUh1QixPQUFyQixDQUFkOztBQU1BLFVBQU1DLGNBQWMsSUFBSUwsTUFBTU0sU0FBVixDQUNsQixDQUFDLFNBQUQsRUFBWSxTQUFaLENBRGtCLEVBRWxCO0FBQ0VDLHdCQUFnQjtBQURsQixPQUZrQixFQUtsQjtBQUNFQyx1QkFBZSxpQkFEakI7QUFFRUMsb0JBQVksZUFGZDtBQUdFQyx1QkFBZSxDQUFDLEVBQUQsRUFBSyxFQUFMLENBSGpCO0FBSUVDLHlCQUFpQixDQUFDLENBQUMsRUFBRixFQUFNLENBQUMsRUFBUDtBQUpuQixPQUxrQixDQUFwQjtBQVlBWixZQUFNYSxVQUFOLENBQWlCL0QsR0FBakIsQ0FBcUJ3RCxXQUFyQjs7QUFFQTlGLG1CQUFhRyxnQkFBYixDQUE4QiwyQkFBOUIsRUFBMkRTLE9BQTNELENBQW1FLFVBQUNDLE9BQUQsRUFBVztBQUMxRUEsZ0JBQVF5RixLQUFSLENBQWNDLE1BQWQsR0FBdUIsY0FBdkI7QUFDSCxPQUZEO0FBR0QsS0F4QkQ7QUF5QkFkLFVBQU1lLEtBQU4sQ0FBWWpCLElBQVo7QUFDRDtBQUNOLENBM0xEIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpPT57XHJcbiAgY29uc3QgbWFwQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xyXG4gIGNvbnN0IG1vZGFsc1NlbGVjdG9yID0gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb2RhbCcpO1xyXG4gIGNvbnN0IG1vZGFsVHJpZ2dlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kYWwtdHJpZ2dlcicpO1xyXG4gIGNvbnN0IGNhbGN1bGF0b3JTZWxlY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNhbGN1bGF0b3Itc2VsZWN0Jyk7XHJcbiAgY29uc3Qgc2xpZGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zbGlkZXInKTtcclxuICBjb25zdCB0aW1lcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGltZXInKTtcclxuICBjb25zdCBhY2NvcmRlb25CdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbl9fdGl0bGUnKTtcclxuICBjb25zdCBtYXNrZWRQaG9uZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtkYXRhLW1hc2tlZD1cInBob25lXCJdJyk7XHJcbiAgY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vZGFsJyk7XHJcblxyXG4gIHN2ZzRldmVyeWJvZHkoKTtcclxuICBtb2RhbHNTZWxlY3Rvci5mb3JFYWNoKChlbGVtZW50KSA9PntcclxuICAgICQoZWxlbWVudCkuaXppTW9kYWwoKTtcclxuICB9KTtcclxuXHJcbiAgbW9kYWxUcmlnZ2Vycy5mb3JFYWNoKCh0cmlnZ2VyKT0+e1xyXG4gICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZGF0YXNldC5vcGVuXHJcbiAgICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLm1vZGFsW2RhdGEtbW9kYWw9JHtpZH1dYCk7XHJcbiAgICAgICQobW9kYWwpLml6aU1vZGFsKCdvcGVuJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBcclxuICBcclxuICBsZXQgaSA9IDA7XHJcbiAgY2FsY3VsYXRvclNlbGVjdHMuZm9yRWFjaCgoc2VsZWN0KT0+e1xyXG4gICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PntcclxuICAgICAgbGV0IHN1bSA9IDA7XHJcbiAgICAgIGxldCBzdW1XaXRob3V0U2FsZSA9IDA7XHJcbiAgICAgIGxldCBjb3VudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jYWxjdWxhdG9yLXNlbGVjdC5hY3RpdmUnKTtcclxuICAgICAgY29uc3QgdGV4dENvdW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigncFtkYXRhLWNhbGN1bGF0b3ItY291bnQ9XCJcIl0nKTtcclxuICAgICAgY29uc3QgdG90YWxQcmljZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N0cm9uZ1tkYXRhLWNhbGN1bGF0b3ItdG90YWw9XCJcIl0nKTtcclxuICAgICAgY29uc3QgdG90YWxQcmljZVdpdGhvdXRTYWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3BhbltkYXRhLWNhbGN1bGF0b3Itc2FsZT1cIlwiXScpO1xyXG4gICAgICBjb25zdCBwcmljZSA9ICtzZWxlY3QuZGF0YXNldC5wcmljZTtcclxuICAgICAgY29uc3QgcHJpY2VXaXRob3V0U2FsZSA9ICtzZWxlY3QuZGF0YXNldC5zYWxlO1xyXG4gICAgICBcclxuICAgICAgaWYoc2VsZWN0LmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuICAgICAgICBpLS07XHJcbiAgICAgICAgc2VsZWN0LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpXHJcbiAgICAgICAgc3VtIC09IHByaWNlXHJcbiAgICAgICAgc3VtV2l0aG91dFNhbGUgLT0gcHJpY2VXaXRob3V0U2FsZVxyXG4gICAgICAgIHRleHRDb3VudC5pbm5lckhUTUwgPSBpXHJcbiAgICAgICAgY291bnQuZm9yRWFjaChjdXJyZW50ID0+IHtcclxuICAgICAgICAgIGNvbnN0IHByaWNlID0gK2N1cnJlbnQuZGF0YXNldC5wcmljZTtcclxuICAgICAgICAgIGNvbnN0IHByaWNlV2l0aG91dFNhbGUgPSArY3VycmVudC5kYXRhc2V0LnNhbGU7XHJcbiAgICAgICAgICBzdW0gKz0gcHJpY2VcclxuICAgICAgICAgIHN1bVdpdGhvdXRTYWxlICs9IHByaWNlV2l0aG91dFNhbGVcclxuICAgICAgICAgIHJldHVybiBzdW0sIHN1bVdpdGhvdXRTYWxlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaSsrO1xyXG4gICAgICAgIHNlbGVjdC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxyXG4gICAgICAgIHN1bSArPSBwcmljZVxyXG4gICAgICAgIHN1bVdpdGhvdXRTYWxlICs9IHByaWNlV2l0aG91dFNhbGVcclxuICAgICAgICB0ZXh0Q291bnQuaW5uZXJIVE1MID0gaTtcclxuICAgICAgICBjb3VudC5mb3JFYWNoKGN1cnJlbnQgPT4ge1xyXG4gICAgICAgICAgY29uc3QgcHJpY2UgPSArY3VycmVudC5kYXRhc2V0LnByaWNlO1xyXG4gICAgICAgICAgY29uc3QgcHJpY2VXaXRob3V0U2FsZSA9ICtjdXJyZW50LmRhdGFzZXQuc2FsZTtcclxuICAgICAgICAgIHN1bSArPSBwcmljZVxyXG4gICAgICAgICAgc3VtV2l0aG91dFNhbGUgKz0gcHJpY2VXaXRob3V0U2FsZVxyXG4gICAgICAgICAgcmV0dXJuIHN1bSwgc3VtV2l0aG91dFNhbGVcclxuICAgICAgICB9KTtcclxuICAgICAgfSAgICAgIFxyXG4gICAgICB0b3RhbFByaWNlLmlubmVySFRNTCA9IHN1bSArICcg0YAuJztcclxuICAgICAgdG90YWxQcmljZVdpdGhvdXRTYWxlLmlubmVySFRNTCA9IHN1bVdpdGhvdXRTYWxlICsgJ9GALic7XHJcbiAgICB9KTtcclxuICBcclxuICB9KTtcclxuICBcclxuICBzbGlkZXJzLmZvckVhY2goc2xpZGVyID0+IHtcclxuICAgIGNvbnN0IHNsaWRlckluaXQgPSBzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlcl9fbGlzdCcpO1xyXG4gICAgY29uc3QgY291bnQgPSBzbGlkZXJJbml0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb3VudCcpO1xyXG4gICAgY29uc3QgbmV4dEFycm93ID0gc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5hcnJvdy1uZXh0JylcclxuICAgIGNvbnN0IHByZXZBcnJvdyA9IHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuYXJyb3ctcHJldicpXHJcbiAgICAkKHNsaWRlckluaXQpLnNsaWNrKHtcclxuICAgICAgc2xpZGVzVG9TaG93Oitjb3VudCxcclxuICAgICAgZG90czogZmFsc2UsXHJcbiAgICAgIHByZXZBcnJvdzogJChwcmV2QXJyb3cpLFxyXG4gICAgICBuZXh0QXJyb3c6ICQobmV4dEFycm93KVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG5cclxuICB0aW1lcnMuZm9yRWFjaCh0aW1lciA9PiB7XHJcbiAgY29uc3QgZ2V0VGltZVJlbWFpbmluZyA9IChlbmR0aW1lKSA9PntcclxuICAgIGNvbnN0IHQgPSBEYXRlLnBhcnNlKGVuZHRpbWUpIC0gRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKTtcclxuICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKCh0IC8gMTAwMCkgJSA2MCk7XHJcbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigodCAvIDEwMDAgLyA2MCkgJSA2MCk7XHJcbiAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IoKHQgLyAoMTAwMCAqIDYwICogNjApKSAlIDI0KTtcclxuICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKHQgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgJ3RvdGFsJzogdCxcclxuICAgICAgJ2RheXMnOiBkYXlzLFxyXG4gICAgICAnaG91cnMnOiBob3VycyxcclxuICAgICAgJ21pbnV0ZXMnOiBtaW51dGVzLFxyXG4gICAgICAnc2Vjb25kcyc6IHNlY29uZHNcclxuICAgIH07XHJcbiAgfVxyXG4gICBcclxuICBjb25zdCBpbml0aWFsaXplQ2xvY2sgPSAoZW5kdGltZSkgPT4ge1xyXG4gICAgY29uc3QgY2xvY2sgPSB0aW1lcjtcclxuICAgIGNvbnN0IGRheXNTcGFuID0gY2xvY2sucXVlcnlTZWxlY3RvcignLnRpbWVyX19kYXknKTtcclxuICAgIGNvbnN0IGhvdXJzU3BhbiA9IGNsb2NrLnF1ZXJ5U2VsZWN0b3IoJy50aW1lcl9faG91cnMnKTtcclxuICAgIGNvbnN0IG1pbnV0ZXNTcGFuID0gY2xvY2sucXVlcnlTZWxlY3RvcignLnRpbWVyX19taW51dGVzJyk7XHJcbiAgICBjb25zdCBzZWNvbmRzU3BhbiA9IGNsb2NrLnF1ZXJ5U2VsZWN0b3IoJy50aW1lcl9fc2Vjb25kcycpO1xyXG4gICBcclxuICAgIGNvbnN0IHVwZGF0ZUNsb2NrID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ID0gZ2V0VGltZVJlbWFpbmluZyhlbmR0aW1lKTtcclxuICAgXHJcbiAgICAgIGRheXNTcGFuLmlubmVySFRNTCA9IHQuZGF5cztcclxuICAgICAgaG91cnNTcGFuLmlubmVySFRNTCA9ICgnMCcgKyB0LmhvdXJzKS5zbGljZSgtMik7XHJcbiAgICAgIG1pbnV0ZXNTcGFuLmlubmVySFRNTCA9ICgnMCcgKyB0Lm1pbnV0ZXMpLnNsaWNlKC0yKTtcclxuICAgICAgc2Vjb25kc1NwYW4uaW5uZXJIVE1MID0gKCcwJyArIHQuc2Vjb25kcykuc2xpY2UoLTIpO1xyXG4gICBcclxuICAgICAgaWYgKHQudG90YWwgPD0gMCkge1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGltZWludGVydmFsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdXBkYXRlQ2xvY2soKTtcclxuICAgIGNvbnN0IHRpbWVpbnRlcnZhbCA9IHNldEludGVydmFsKHVwZGF0ZUNsb2NrLCAxMDAwKTtcclxuICB9XHJcbiAgICBjb25zdCBkZWFkbGluZSA9IG5ldyBEYXRlKERhdGUucGFyc2UobmV3IERhdGUoKSkgKyAxNSAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xyXG4gICAgaW5pdGlhbGl6ZUNsb2NrKGRlYWRsaW5lKTtcclxuICB9KTtcclxuXHJcbiAgYWNjb3JkZW9uQnV0dG9ucy5mb3JFYWNoKGFjY29yZGVvbiA9PiB7XHJcbiAgICBhY2NvcmRlb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PntcclxuICAgICAgYWNjb3JkZW9uQnV0dG9ucy5mb3JFYWNoKGFjY29yZGVvbiA9PiB7XHJcbiAgICAgICAgYWNjb3JkZW9uLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTtcclxuICAgICAgICBhY2NvcmRlb24uY2xvc2VzdCgnLmFjY29yZGVvbicpLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGFjY29yZGVvbi5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XHJcbiAgICAgIGFjY29yZGVvbi5jbG9zZXN0KCcuYWNjb3JkZW9uJykuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmFxJykuc2Nyb2xsSW50b1ZpZXcoe2JlaGF2aW9yOiAnc21vb3RoJ30pO1xyXG4gICAgfSk7XHJcbiAgfSlcclxuXHJcbiAgXHJcbiAgY29uc3QgY3VzdG9tT3B0aW9ucyA9IHtcclxuICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uICh2YWwsIGUsIGZpZWxkLCBvcHRpb25zKSB7XHJcbiAgICAgIGlmICh2YWwucmVwbGFjZSgvXFxEL2csIFwiXCIpLmxlbmd0aCA9PT0gMikge1xyXG4gICAgICAgIHZhbCA9IHZhbC5yZXBsYWNlKFwiOFwiLCBcIlwiKTtcclxuICAgICAgICBmaWVsZC52YWwodmFsKTtcclxuICAgICAgfVxyXG4gICAgICBmaWVsZC5tYXNrKFwiKzcgKDk5OSkgOTk5LTk5LTk5XCIsIG9wdGlvbnMpO1xyXG4gICAgfSxcclxuICAgIHBsYWNlaG9sZGVyOiBcIis3IChfX18pIF9fXy1fXy1fX1wiLFxyXG4gIH07XHJcblxyXG4gIG1hc2tlZFBob25lcy5mb3JFYWNoKGlucHV0ID0+IHtcclxuICAgICQoaW5wdXQpLm1hc2soXCIrNyAoMDAwKSAwMDAtMDAtMDBcIiwgY3VzdG9tT3B0aW9ucyk7XHJcbiAgfSk7XHJcbiAgXHJcbiAgbW9kYWxzLmZvckVhY2gobW9kYWwgPT4ge1xyXG4gICAgY29uc3QgaW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtkYXRhLW1hc2tlZD1cInBob25lXCJdJyk7XHJcbiAgICAkKGlucHV0KS5tYXNrKFwiKzcgKDAwMCkgMDAwLTAwLTAwXCIsIGN1c3RvbU9wdGlvbnMpO1xyXG4gIH0pO1xyXG5cclxuICBpZihtYXBDb250YWluZXIpIHtcclxuICAgICAgICBjb25zdCBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICAgIGNvbnN0IG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XHJcbiAgICAgICAgICAgIGNlbnRlcjogWzYwLjAyODk3OSwgMzAuMzMxMTk1XSxcclxuICAgICAgICAgICAgem9vbTogMTYsXHJcbiAgICAgICAgICAgIGNvbnRyb2xzOiBbXCJ6b29tQ29udHJvbFwiXSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICBjb25zdCBteVBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXHJcbiAgICAgICAgICAgIFs2MC4wMjg5NzksIDMwLjMzMTE5NSBdLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgYmFsbG9vbkNvbnRlbnQ6IFwi0LMuINCh0LDQvdC60YIt0J/QtdGC0LXRgNCx0YPRgNCzLCDRg9C7LiDQldGB0LXQvdC40L3QsCAx0LoxLCDRgdGCLtC8LiDQntC30LXRgNC60LhcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIGljb25JbWFnZUhyZWY6IFwiL2ltZy9tYXJrZXIuc3ZnXCIsXHJcbiAgICAgICAgICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXHJcbiAgICAgICAgICAgICAgaWNvbkltYWdlU2l6ZTogWzQyLCA1Nl0sXHJcbiAgICAgICAgICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTIxLCAtNTZdLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmspO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBtYXBDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnltYXBzLTItMS03Ny1ncm91bmQtcGFuZScpLmZvckVhY2goKGVsZW1lbnQpPT57XHJcbiAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5maWx0ZXIgPSAnZ3JheXNjYWxlKDEpJztcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgeW1hcHMucmVhZHkoaW5pdCk7ICAgICAgXHJcbiAgICAgIH1cclxufSk7XHJcbiJdfQ==
